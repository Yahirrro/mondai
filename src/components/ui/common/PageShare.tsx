import { fuego } from '@nandorojo/swr-firestore'
import { Fuego } from '@lib/fuego'
import { useRouter } from 'next/router'
import { sendLogEvent } from '@lib/api'

type Props = {
  text: string
  url: string
  style?: React.CSSProperties
}

export const PageShare: React.FunctionComponent<Props> = (props) => {
  return (
    <div className="PageShare" style={props.style}>
      <PageShareIcon url={props.url} text={props.text} type="twitter" />
      <PageShareIcon url={props.url} text={props.text} type="line" />
      <style jsx>
        {`
          .PageShare {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-flow: wrap;
            @media (max-width: 750px) {
              display: grid;
              grid-template-columns: 1fr;
            }
          }
        `}
      </style>
    </div>
  )
}

export const PageShareIcon: React.FunctionComponent<{
  url: string
  type: 'twitter' | 'line'
  text?: string
}> = (props) => {
  const router = useRouter()
  const url = () => {
    switch (props.type) {
      case 'twitter':
        return {
          href: `https://twitter.com/intent/tweet?text=${encodeURIComponent(
            props.text
          )}&hashtags=mondai,クイズアプリmondai&url=${encodeURIComponent(
            props.url
          )}`,
        }
      case 'line':
        return {
          href:
            'https://social-plugins.line.me/lineit/share?url=' +
            encodeURIComponent(props.url),
        }
    }
  }
  const click = () => {
    sendLogEvent('share', {
      content_type: 'quiz',
      quiz_id: router.query?.quizId,
      method: props.type,
    })
  }
  return (
    <a
      className={`PageShareIcon PageShareIcon-${props.type}`}
      target="_blank"
      rel="noopener noreferrer"
      {...url()}
      onClick={click}>
      {props.type == 'twitter' && (
        <>
          <svg
            width="26"
            height="26"
            viewBox="0 0 20 20"
            fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <path
              d="M20 3.72583C19.4431 4.52257 18.7598 5.20175 17.9502 5.76337C17.9582 5.914 17.9621 6.08424 17.9621 6.27411C17.9621 7.32903 17.8022 8.38523 17.4824 9.44271C17.1626 10.5002 16.674 11.5124 16.0167 12.4793C15.3595 13.4462 14.5765 14.3028 13.668 15.0491C12.7594 15.7954 11.6672 16.3905 10.3915 16.8343C9.11571 17.2781 7.74846 17.5 6.28969 17.5C4.01305 17.5 1.91649 16.9089 0 15.7267C0.340154 15.7631 0.666389 15.7813 0.978708 15.7813C2.88066 15.7813 4.57941 15.2179 6.07495 14.091C5.18815 14.0754 4.39396 13.8128 3.69237 13.3034C2.99078 12.7939 2.50796 12.143 2.24392 11.3504C2.50491 11.3983 2.7625 11.4222 3.01669 11.4222C3.38258 11.4222 3.7426 11.3763 4.09677 11.2845C3.15039 11.1022 2.36529 10.6489 1.74147 9.92448C1.11767 9.20011 0.805766 8.36406 0.805766 7.41631V7.36746C1.38666 7.6768 2.00627 7.84134 2.6646 7.86109C2.10397 7.50163 1.65948 7.03289 1.33112 6.45485C1.00274 5.87682 0.838551 5.25129 0.838551 4.57826C0.838551 3.86844 1.02349 3.20746 1.39338 2.59533C2.42255 3.80998 3.6696 4.78077 5.13454 5.5077C6.59949 6.23464 8.17111 6.63835 9.8494 6.71885C9.77781 6.43195 9.74196 6.13255 9.74183 5.82065C9.74183 4.73163 10.1425 3.80177 10.944 3.03106C11.7454 2.26035 12.7123 1.875 13.8446 1.875C15.0301 1.875 16.0286 2.29016 16.8403 3.12048C17.7676 2.94383 18.6358 2.6243 19.4451 2.16191C19.1333 3.10555 18.5326 3.83351 17.6428 4.34578C18.4606 4.25232 19.2463 4.04567 20 3.72583H20Z"
              fill="white"
            />
          </svg>
          <p>ツイート</p>
        </>
      )}
      {props.type == 'line' && (
        <>
          <svg
            width="26"
            height="26"
            viewBox="0 0 20 20"
            fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <path
              d="M16.1356 7.72438C16.2062 7.72196 16.2766 7.73373 16.3425 7.759C16.4084 7.78427 16.4686 7.82252 16.5194 7.87147C16.5702 7.92042 16.6106 7.97907 16.6382 8.04393C16.6658 8.10878 16.68 8.17851 16.68 8.24896C16.68 8.31942 16.6658 8.38915 16.6382 8.454C16.6106 8.51886 16.5702 8.57751 16.5194 8.62646C16.4686 8.67541 16.4084 8.71366 16.3425 8.73893C16.2766 8.7642 16.2062 8.77597 16.1356 8.77354H14.6738V9.70862H16.1356C16.2066 9.70516 16.2776 9.71613 16.3443 9.74085C16.4109 9.76558 16.4718 9.80354 16.5233 9.85245C16.5748 9.90136 16.6158 9.96019 16.6438 10.0254C16.6718 10.0906 16.6862 10.1607 16.6862 10.2316C16.6862 10.3026 16.6718 10.3727 16.6438 10.4379C16.6158 10.5031 16.5748 10.5619 16.5233 10.6108C16.4718 10.6597 16.4109 10.6977 16.3443 10.7224C16.2776 10.7472 16.2066 10.7581 16.1356 10.7547H14.15C14.0112 10.7542 13.8782 10.6989 13.7802 10.6009C13.6822 10.5028 13.627 10.3701 13.6269 10.2316V6.26691C13.6269 5.97828 13.8613 5.74139 14.15 5.74139H16.1394C16.2743 5.74835 16.4014 5.80682 16.4944 5.9047C16.5873 6.00257 16.6389 6.13235 16.6385 6.26714C16.6381 6.40193 16.5857 6.5314 16.4922 6.62873C16.3987 6.72605 16.2712 6.78377 16.1362 6.78993H14.6744V7.72501L16.1356 7.72438ZM12.9269 10.231C12.9257 10.3699 12.8697 10.5026 12.7709 10.6005C12.6721 10.6983 12.5386 10.7533 12.3994 10.7534C12.317 10.7542 12.2355 10.7359 12.1614 10.6999C12.0873 10.6638 12.0226 10.6111 11.9725 10.5458L9.93812 7.7861V10.2304C9.93812 10.3691 9.88288 10.5021 9.78454 10.6002C9.6862 10.6983 9.55282 10.7534 9.41375 10.7534C9.27468 10.7534 9.1413 10.6983 9.04296 10.6002C8.94462 10.5021 8.88937 10.3691 8.88937 10.2304V6.26566C8.88937 6.04186 9.03625 5.84113 9.2475 5.76944C9.29967 5.75106 9.35468 5.74199 9.41 5.74264C9.5725 5.74264 9.7225 5.83053 9.82312 5.95397L11.8737 8.71993V6.26566C11.8737 5.97703 12.1081 5.74014 12.3981 5.74014C12.6881 5.74014 12.9256 5.97703 12.9256 6.26566L12.9269 10.231ZM8.14188 10.231C8.14121 10.3701 8.08533 10.5032 7.98645 10.6012C7.88758 10.6993 7.75379 10.7542 7.61438 10.754C7.476 10.7529 7.34368 10.6973 7.24619 10.5994C7.14869 10.5014 7.09391 10.369 7.09375 10.231V6.26628C7.09375 5.97765 7.32812 5.74077 7.61812 5.74077C7.9075 5.74077 8.1425 5.97765 8.1425 6.26628L8.14188 10.231ZM6.0875 10.754H4.09813C3.95886 10.7537 3.82535 10.6986 3.72659 10.6007C3.62782 10.5028 3.57178 10.3699 3.57062 10.231V6.26628C3.57062 5.97765 3.80813 5.74077 4.09813 5.74077C4.38813 5.74077 4.6225 5.97765 4.6225 6.26628V9.708H6.0875C6.22657 9.708 6.35995 9.7631 6.45829 9.86119C6.55663 9.95928 6.61188 10.0923 6.61188 10.231C6.61188 10.3697 6.55663 10.5028 6.45829 10.6009C6.35995 10.6989 6.22657 10.754 6.0875 10.754ZM20 8.09717C20 3.6331 15.5106 0 10 0C4.48937 0 0 3.6331 0 8.09717C0 12.0974 3.55813 15.4481 8.3625 16.0846C8.68813 16.1526 9.13062 16.2991 9.245 16.5752C9.34562 16.8246 9.31 17.2111 9.2775 17.4748L9.14062 18.322C9.10125 18.5719 8.93875 19.3063 10.0131 18.8581C11.0906 18.4099 15.7781 15.4687 17.8775 13.0587C19.3131 11.4909 20 9.88005 20 8.09717Z"
              fill="white"
            />
          </svg>
          <p>LINEで送る</p>
        </>
      )}
      <style jsx>
        {`
          .PageShareIcon {
            white-space: nowrap;
            padding: 5px 15px;
            display: inline-grid;
            grid-template-columns: 26px 1fr;
            gap: 5px;
            border-radius: 10px;
            @media (max-width: 750px) {
              display: grid;
              width: 100%;
            }
            p {
              font-weight: bold;
              color: white;
              text-align: center;
            }
            &-twitter {
              background-color: #1da1f2;
            }
            &-line {
              background-color: #00b833;
            }
          }
        `}
      </style>
    </a>
  )
}
